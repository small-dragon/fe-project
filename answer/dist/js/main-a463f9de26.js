var A=function(){var t=!1,e=!0,n="http://weixin.ichsh.com.cn",s=location.href.match(/.*\//)[0],i=null,a={},o=0,r=!1,l=!1,u=!0,c=Date.now()<new Date("2016/10/1 12:00").getTime(),d=[{questionId:"124",questionInfo:"发生在北京卢沟桥的历史事变名叫？",questionA:"七七事件",questionB:"九一八事变",questionC:"五四运动",questionD:"台儿庄会战"},{questionId:"50",questionInfo:"人民英雄纪念碑上的雕塑作品《五四运动》是？",questionA:"浮雕",questionB:"素描",questionC:"3D画",questionD:"炭画"},{questionId:"99",questionInfo:'李白笔下的"飞流直下三千尺， 疑是银河落九天"指的是哪个风景区？',questionA:"庐山",questionB:"泰山",questionC:"衡山",questionD:"嵩山"},{questionId:"3",questionInfo:"吴敬梓是哪本名著的作者？ ",questionA:"《黄帝内经》",questionB:"《盗墓笔记》",questionC:"《鬼吹灯》",questionD:"《儒林外史》"},{questionId:"137",questionInfo:'"从何时起，对最高统治者称"王"？',questionA:"唐朝",questionB:"商朝",questionC:"明朝",questionD:"清朝"}],g=30,f=function(){h(n+"/index.php/Activity/Public/getJssdkTicket",{url:location.href.split("#")[0]},"weixincallback").then(function(t){return console.info(t),"1"!=t.status?void x(t.msg):(t=t.data,a={debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","showMenuItems"]},wx.config(a),wx.ready(function(){console.info("ready"),window.WEIXINREADY=!0,i&&i(),wx.showMenuItems({menuList:["menuItem:profile","menuItem:addContact"]})}),void wx.error(function(t){console.error(t.errMsg)}))})},m=function(t,e,n,o){var r={title:t||"中国邮政“祖国在我心中”国庆主题活动",desc:e||"答题、拼图大抽奖，每天都有抽奖机会！连玩7天~豪礼多多，快来参与吧！",link:o||"http://weixin.ichsh.com.cn/guoqing/",imgUrl:n||s+"images/logo.jpg",success:function(t){},cancel:function(t){}},l=$.extend({},r);e&&(l.title=l.desc);var u=function(){wx.onMenuShareQQ(r),wx.onMenuShareWeibo(r),wx.onMenuShareAppMessage(r),wx.onMenuShareTimeline(l),a.swapTitleInWX=!1};window.WEIXINREADY?u():i=function(){u()}},p=function(){var e=$.Deferred();return h(n+"/index.php/Activity/Guoqing/isLogin","","isLoginCallback").then(function(s){if(t&&(s.status=1),1==s.status)e.resolve();else{var i=(s.data&&s.data.appid||"wxac7d69a69e29b843",encodeURIComponent(window.location.href)),a=n+"/index.php/Activity/Public/go2login?jump="+i;window.location.href=a}}),e.promise()},h=function(t,e,n){return $.ajax({url:t,type:"get",data:e,async:!0,dataType:"jsonp",jsonp:"callback",jsonpCallback:n,success:function(){},error:function(){}})},v=function(t){$(".loading").removeClass("hide"),h(n+"/index.php/Activity/GuoqingQa/play",{ans:JSON.stringify(t)},"submitAnswersCallback").then(function(t){if($(".loading").addClass("hide"),1!==t.status)return void x(t.msg);var e=t.data.point,n="";switch(o=t.data.lotterychance,l=t.data.prizeFlag,r=l&&t.data.prize.prizetype,!0){case e>=3&&e<=5:n=t.data.doneLottery?'<p class="title">恭喜你答对'+e+'道题！</p><img class="text" src="images/text-onechance.png"><br/><a class="result-btn gift"></a>':'<p class="title">恭喜您，挑战成功！</p><img class="text useup" src="images/text-useup.png"><br/><a class="result-btn cry"></a><br/><a class="result-btn try-again">继续挑战</a>';break;case e<=2:n='<p class="title">很遗憾，您只答对'+e+'道题！</p><img class="text" src="images/text-fail.png"><br/><a class="result-btn try-again">继续挑战</a>';break;default:n='<p class="title">报错了</p><img class="text" src="images/text-fail.png"><br/><a class="result-btn try-again">继续挑战</a>'}$(".result").removeClass("hide"),$(".result .content").html(n)})},x=function(t){var e='<p class="title">'+t+"</p>";$(".result").removeClass("hide"),$(".result .content").html(e)},b=function(){var t,e=function(t){$(".time").text(t+"s")},s=function(){var t='<p class="title">&nbsp;</p><img class="text" src="images/text-check.png"><br/><a class="result-btn return"></a>';$(".result").removeClass("hide"),$(".result .content").html(t)},i=function(){var t='<p class="title">很遗憾，时间已用完</p><img class="text" src="images/text-fail.png"><br/><a class="result-btn try-again">继续挑战</a>';$(".result").removeClass("hide"),$(".result .content").html(t)};return c&&u?(Problem.init($(".play .questions-container"),{timing:g,data:d,tickTimeHandler:e,notifyHandler:s,gameOverHandler:function(t,e){e?i():(str='<p class="title">恭喜您，挑战成功！</p><img class="text wait" src="images/text-wait.png"><br/><a class="result-btn try-again smile">继续挑战</a>',$(".result").removeClass("hide"),$(".result .content").html(str))}}),void $(".i-ready").addClass("hide")):void h(n+"/index.php/Activity/GuoqingQa/getQuestion","","getAnswerCB").then(function(n){return 1!==n.status?void x(n.msg):(t=n.questions,Problem.init($(".play .questions-container"),{timing:g,data:t,notifyHandler:s,tickTimeHandler:e,gameOverHandler:function(t,e){e?i():v(t)}}),void $(".i-ready").addClass("hide"))})},q=function(){$(".swrap").on("touchend",function(t){var n=$(t.target);if(n.hasClass("to-begin")&&($(".sample").addClass("hide"),$(".play").removeClass("hide"),$(".i-ready").removeClass("hide"),b(),e?$("audio")[0].play():$(".i-music").addClass("off")),n.hasClass("i-music")){var s=$("audio")[0];n.hasClass("off")?(s.play(),n.removeClass("off"),sessionStorage.setItem("isMusic",!0)):(s.pause(),n.addClass("off"),sessionStorage.setItem("isMusic",!1))}if(n.hasClass("try-again")&&($(".result").addClass("hide"),$(".i-ready").removeClass("hide"),b()),n.hasClass("gift")){var i="";i=l?'<p class="title">今天还剩'+o+'次抽奖机会</p>恭喜您！<br/><img class="text" src="images/prize'+r+'.png"><br/><a class="result-btn get-prize" href="/tpcluster/guoqing/#/my-prize">去领奖</a>':o?'<p class="title">今天还剩'+o+'次抽奖机会</p><img class="text" src="images/text-sorry.png"><br/><a class="result-btn try-again">继续挑战</a>':'<p class="title">您今天的抽奖次数已用完，<br/>明天再接再厉噢~</p><img class="text" src="images/text-sorry.png"><br/><a class="result-btn try-again">继续挑战</a>',$(".result .content").html(i)}n.hasClass("return")&&$(".result").addClass("hide")})},C=function(){window.onload=function(){$(".loading").addClass("hide"),e="false"!==sessionStorage.getItem("isMusic"),console.log("is"+e),u&&c?(q(),f(),m()):p().then(function(){q(),f(),m()})}};return{i:C}}();A.i(),Problem=function(){var t={timing:30,tickTimeHandler:function(){},notifyHandler:function(){},gameOverHandler:function(){},data:[]},e=null,n=[],s=0,i=!0,a=function(){t.tickTimeHandler(t.timing),t.timing--,t.timing<0&&r(!0)},o=function(){t.notifyHandler()},r=function(s){var i={};e&&clearInterval(e),t.data.forEach(function(t,e,s){i[t.questionId]=t.rule[n[e]]?t.rule[n[e]]:"s"}),t.gameOverHandler(i,s)},l=function(e){t.data.forEach(function(t,e,n){t.rule=["A","B","C","D"].sort(function(){return.5-Math.random()})}),i&&($(".play").on("touchend",function(i){var a=$(i.target);if(a.hasClass("to-next")){var l=$(this).find(".answer.checked");if(!l.length)return void o();n.push(l.attr("data-i")),s==t.data.length-1?r():(s++,s==t.data.length-1&&a.text("提交答案"),u(e,s))}a.hasClass("answer")&&a.addClass("checked").siblings().removeClass("checked")}),i=!1)},u=function(e,n){var s="",i=["A","B","C","D"],a=t.data[n];e.find(".question").text(n+1+"."+a.questionInfo),a.rule.forEach(function(t,e,n){s+='<li class="answer" data-i="'+e+'">'+i[e]+"."+a["question"+t]+"</li>"}),e.find(".answers").html(s)},c=function(){s=0,n=[],$(".to-next").text("下一题")},d=function(n,i){t=$.extend(t,i),c(),l(n),u(n,s),e&&clearInterval(e),a(),e=setInterval(function(){a()},1e3)},g=function(){return t.timing};return{init:d,getTiming:g}}();